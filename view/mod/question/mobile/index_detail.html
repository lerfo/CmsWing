
{% extends "../../../topic/mobile/inc/base.html" %}
{% block style %}
<link rel="stylesheet" href="/static/assets/plugins/wangEditor/css/wangEditor.min.css" type="text/css"/>
<link rel="stylesheet" href="/static/webapp/libs/deitor.wang/css/wangEditor-mobile.css">
<style>
    *{
        -webkit-user-select:text;
    }
    html,
    body {
        background-color: #efeff4;
    }
    .mui-views,
    .mui-view,
    .mui-pages,
    .mui-page,
    .mui-page-content {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        background-color: #efeff4;
    }
    .mui-pages {
        top: 46px;
        height: auto;
    }
    .mui-scroll-wrapper,
    .mui-scroll {
        background-color: #efeff4;
    }
    .mui-page.mui-transitioning {
        -webkit-transition: -webkit-transform 300ms ease;
        transition: transform 300ms ease;
    }
    .mui-page-left {
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
    }
    .mui-ios .mui-page-left {
        -webkit-transform: translate3d(-20%, 0, 0);
        transform: translate3d(-20%, 0, 0);
    }
    .mui-navbar {
        position: fixed;
        right: 0;
        left: 0;
        z-index: 10;
        height: 44px;
        background-color: #f7f7f8;
    }
    .mui-navbar .mui-bar {
        position: absolute;
        /* background: transparent; */
        text-align: center;
    }
    .mui-android .mui-navbar-inner.mui-navbar-left {
        opacity: 0;
    }
    .mui-ios .mui-navbar-left .mui-left,
    .mui-ios .mui-navbar-left .mui-center,
    .mui-ios .mui-navbar-left .mui-right {
        opacity: 0;
    }
    .mui-navbar .mui-btn-nav {
        -webkit-transition: none;
        transition: none;
        -webkit-transition-duration: .0s;
        transition-duration: .0s;
    }
    .mui-navbar .mui-bar .mui-title {
        display: inline-block;
        width: auto;
    }
    .mui-page-shadow {
        position: absolute;
        right: 100%;
        top: 0;
        width: 16px;
        height: 100%;
        z-index: -1;
        content: '';
    }
    .mui-page-shadow {
        background: -webkit-linear-gradient(left, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
        background: linear-gradient(to right, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
    }
    .mui-navbar-inner.mui-transitioning,
    .mui-navbar-inner .mui-transitioning {
        -webkit-transition: opacity 300ms ease, -webkit-transform 300ms ease;
        transition: opacity 300ms ease, transform 300ms ease;
    }
    .mui-page {
        display: none;
    }
    .mui-pages .mui-page {
        display: block;
    }
    .mui-page .mui-table-view:first-child {
        margin-top: 15px;
    }
    .mui-page .mui-table-view:last-child {
        margin-bottom: 30px;
    }
    .mui-table-view {
        margin-top: 20px;
    }

    .mui-table-view span.mui-pull-right {
        color: #999;
    }
    .mui-table-view-divider {
        background-color: #efeff4;
        font-size: 14px;
    }
    .mui-table-view-divider:before,
    .mui-table-view-divider:after {
        height: 0;
    }
    .head {
        height: 40px;
    }
    #head {
        line-height: 40px;
    }
    .head-img {
        width: 40px;
        height: 40px;
    }
    #head-img1 {
        position: absolute;
        bottom: 10px;
        right: 40px;
        width: 40px;
        height: 40px;
    }
    .update {
        font-style: normal;
        color: #999999;
        margin-right: -25px;
        font-size: 15px
    }
    .mui-fullscreen {
        position: fixed;
        z-index: 20;
        background-color: #000;
    }
    .mui-ios .mui-navbar .mui-bar .mui-title {
        position: static;
    }
    /*问题反馈在setting页面单独的css*/
    #feedback .mui-popover{
        position: fixed;
    }
    #feedback .mui-table-view:last-child {
        margin-bottom: 0px;
    }
    #feedback .mui-table-view:first-child {
        margin-top: 0px;
    }
    /*问题反馈在setting页面单独的css==end*/
    

    
    .community-padded{ 
    	background-color: #F0FAFB ;
    	padding: 10px;
    	margin: 0
    }
    .article-container{
        width: auto !important;
        margin:10px !important; 
    }
    /* .question-padded{
    	background-color: #fff ;
    	padding: 10px;
    	margin: 0
    } */
    .detail .avatar{
        width: 60px;
        height: 60px;
    }

    .name{
        margin-top: 13px;
    }

    .time{
        position:fixed;
        right:5%;
    }
    .view-span{
        margin-left: 20px;
        margin-right: 3px; 
    }
    .cmswing-container{
       /*  margin:10px; */
    }
	.mui-table-view:before,.mui-card-header:after,.mui-card-footer:before{
        height: 0 !important;
    }
    .comment-h1{
        padding-top:40px;
        margin-left:20px;
        margin-bottom: 20px;
        font-size: 24px;
        color: #000;
    }

    .question_card{
        padding: 10px 3% 20px 3%;
    }
    .question_card .mui-card{
        box-shadow:none;
    }
    .comment-h1:after, .question_card .mui-card:after{
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        height: 1px;
        content: '';
        -webkit-transform: scaleY(.5);
        transform: scaleY(.5);
        background-color: #c8c7cc;
    }
    .comment-avatar{
        border-radius: 50%;
    }
    .comment-txt{
        margin-top:4px;
    }
    .mui-card-header.mui-card-media{
        padding-bottom:0px !important;
    }
    .mui-card-content .wangEditor-txt{
        margin-top: 0 !important;
    }
    .question_card .mui-card{
        margin:0; 
    }
    .out{
        display: none;
    }
	/* .wangEditor-mobile-menu-container{
		display: block !important;
		margin-top: 44px;
		width: 100%;
		margin:44px 10px 0px 10px;
	}
	.wangEditor-mobile-menu-container .tip{
		display: none;
	} */

    {% if category.id== 124 %}
    #mediaName{
        font-size:24px;
        color: #000 !important;
        transform-origin: 0px 0px 0px; opacity: 1; transform: scale(1, 1);
    }
    .question_card,.mui-card,.wangEditor-txt{
        background-color: #F0FAFB !important;
    }
    .quetion-btn{
        width: 100%;
        font-size: 17px;
    }
    {% else %}
    /* body{
    	background-color: #fff !important;
    }
    .mui-views, .mui-view, .mui-pages, .mui-page, .mui-page-content{
    	background-color: #fff !important;
    }
    */#app.mui-views,.mui-scroll-wrapper, .mui-scroll{
    	background-color: #fff !important;
    } 
    .question_card{
    	background-color: #fff;
        min-height: 178px;
    }
	.nickName{
        font-size:16px;
		color: #000 !important;
    }
    .putQuestion{
        font-size:16px;
		color: #999999 !important;
    }
    .dataTime{
    	position: fixed;
    	right: 5%;
    	margin-top: -22px;
        font-size:12px;
		color: #000 !important;
    }
    .question-sign{
    	font-size: 14px;

    }
	.reply-img{
		width: 10px;
		height: 12px;
	}
    .view-img{
		width: 13px;
		height: 11px;
    }
    #article.nopadding.wangEditor-txt{
        background-color: #F0FAFB !important;
    }
    .quetion-btn{
        width: 100%;
        font-size: 17px;
    }
    {% endif %}
</style>
{% endblock %}
{%block bodyattr%} class="mui-fullscreen"{%endblock%}
{% block content %}


<!--页面主结构开始-->
<div id="app" class="mui-views ">
    <div class="mui-view">
        {##}
        <div class="mui-navbar">
        </div>

        <div class="mui-pages">
        </div>
    </div>
</div>
<!--页面主结构结束-->
<div class="mui-page" id="index">
    <div class="mui-navbar-inner mui-bar mui-bar-nav">
        {% include "../../../topic/mobile/inc/top.html" %}
    </div>
    {#
    <div class="mui-navbar-inner mui-bar mui-bar-nav">
        <!--<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>-->
        <!--<a href="#answer" data-toggle="tab" class="mui-icon iconfont icon-forward"><span class="mui-badge">9</span></a>-->
        <!--<h1 class="mui-title"><img src="/static/webapp/img/logo.png" ></h1>-->
        <!--<span class="mui-icon iconfont icon-post mui-pull-right"></span>-->
        <!--<a href="#answer" data-toggle="tab" class="mui-left  mui-btn  mui-btn-link mui-btn-nav mui-pull-left">-->
            <!--<span class="mui-icon iconfont icon-forward"></span>-->
        <!--</a>-->
        <!--<h1 class="mui-title">dfdsf</h1>-->
        {%if controller.is_login%}
        <a  href="#answer" data-toggle="tab" type="button" class="mui-left mui-btn mui-btn-link mui-btn-nav mui-pull-left">

            <span class="mui-icon iconfont icon-forward"> <span class="mui-badge">29</span></span>
                <!--回复-->

        </a>
        {%endif%}
        <h1 class="mui-center mui-title"></h1>
        <a  href="/mod/question/sys/add/cid/{{category.id}}" data-toggle="tab" type="button" class="mui-left mui-btn mui-btn-link  mui-pull-right">
            <span class="mui-icon  iconfont icon-post"></span>
            <!--发布-->
        </a>
    </div>
    #}
    {% include "../../../topic/mobile/inc/nav.html" %}
    <div class="mui-page-content detail" >
            <div class="mui-scroll-wrapper margin-bottom-100" id="pullrefresh">
                <div class="mui-scroll">
        <div class="mui-content-padded community-padded"  style="">
            
            <div class="article-header">

                <div class="pgc-bar-top mui-clearfix margin-top-10" >
                	{% if category.id== 124 %}
				    {% else %}
				    {% endif %}

				    {% if category.id== 124 %}
                    <a href="#" ga_category="toutiaohao" ga_label="" ga_event="click" class="avatar-link vwo-media-profile">
                        <div class="avatar">
                            <img src="/uc/index/avatar/uid/{{info.uid}}" class="avatar">
                        </div>
                    </a>
                    <div class="subtitle">
                        <p class="name">
                            <a  class="screen-name vwo-media-profile">
                                <span id="mediaName">{{info.uid|get_nickname}}</span>
                            </a>
                        </p>
                        
                        <a class="time mui-row" >

                            <!-- <span class="original original-fix">原创</span> -->

                            <span>{{ info.update_time|dateformat('Y-m-d H:i') }}</span>
                            <span class="view-span ">
                                <img src="/static/assets/images/browse.png" alt="">
                            </span>
                            <span>{{info.view}}</span>
                        </a>
                    </div>
					{% else %}
                    <div class="subtitle">
                        <p>
	                        <span class="nickName">{{info.uid|get_nickname}}</span>
	                        <span class="putQuestion">提了一个问题</span>
                            <span class="dataTime">{{ info.update_time|dateformat('Y-m-d') }}</span> 
                        </p>
                        {#
                        <a class="time" >
                            <!-- <span class="original original-fix">原创</span> -->
                            <span>{{ info.update_time|dateformat('Y-m-d') }}</span>
                            <span class="view-span ">
                                <img src="/static/assets/images/browse.png" alt="">
                            </span>
                            <span>{{info.view}}</span>
                        </a>
                        #}
                    </div>

				    {% endif %}
                </div>
		
                <!-- <div class="favor-wrapper">
                    <button type="button" class="mui-btn mui-btn-primary mui-btn-outlined">关注</button>
                </div> -->
            </div>
            <!-- 文章标题 -->
            <h1 class="title margin-top-20 margin-left-10">{{info.title}}</h1>
            {# #}
            <article class="wangEditor-container cmswing-container  article-container" >

                <div class="wangEditor-txt nopadding" id="article">
                    {{info.detail|safe}}
                </div>
                <div class="more text-right" style="background-color: #F0FAFB;">
                    <a>
                        <span style="color: #b2b2b2;">显示全部</span>
                        <i class="i1"></i>
                        <i class="i2"></i>
                    </a>   
                </div>
            </article>
            {% if category.id== 125 %}
           	<div class="question-sign">
           		<span class="reply-span ">
	                <img src="/static/assets/images/reply.png" alt="" class="reply-img">
	            </span>
	            <span>{{info.answer_count}}人回答</span>
				<span class="view-span ">
	                <img src="/static/assets/images/browse.png" alt="" class="view-img">
	            </span>
	            <span>{{info.view}}人浏览</span>
           	</div>
		    {% endif %}
            <div class="mui-content-padded">
                {% rkeywords data ="tags",type="1",mod_id="8",id=info.id%}
                {%set color = ["btn-primary","mui-badge-primary","mui-badge-success","mui-badge-warning","mui-badge-danger","mui-badge-purple"]%}
                {%for k in tags%}
                <a href="{{k.url}}" class="mui-badge {{color|random}}">
                    {{k.keyname}}
                </a>
                {%endfor%}

            </div>
        </div>
        <!--评论-->
        <ul class="mui-table-view question_card">
        	{% if category.id== 124 %}
            	<p class="comment-h1">评论</p>
		    {% endif %}
			


			

            {% set i=1 %}
            {%for val in answer%}
                {% if i<=8 %}
                {% set i=i+1 %}
            <div class="mui-card" id="a{{val.answer_id}}">
                <div class="mui-card-header mui-card-media">
                    <img src="/uc/index/avatar/uid/{{val.uid}}" class="comment-avatar">
                    <div class="mui-media-body">
                        {{val.uid|get_nickname}}
                        <!-- <p>发表于 {{val.add_time|moment}}</p> -->
                        <p class="comment-txt">{{ val.add_time|dateformat('Y-m-d') }}</p>
                    </div>
                </div>
                <div class="mui-card-content">
                    <div class="mui-card-content-inner padding-top-0 padding-bottom-0" >
                        <div class="wangEditor-container cmswing-container">
                            <div class="wangEditor-txt nopadding">
                                {{val.answer_content|safe}}
                            </div>
                        </div>
                    </div>
                </div>
                {#
                <ul class="list-inline size-12 margin-top-10">
                    <li class="pull-right">
                        <a href="javascript:;"  class="text-info comment-reply" data-comment="comment-reply-{{a.answer_id}}"> 
                        <i class="fa fa-reply"></i> 
                        <span id="oc-{{a.answer_id}}">回复</span>全部评论 (<span id="count-{{a.answer_id}}">{{a.ccount}}</span>)</a>
                    </li>  
                    {%if controller.user.uid == a.uid or (controller.user.uid|in_Array(http.config('user_administrator'))) %}
                    <li class="pull-right">
                        <a href="/mod/question/ajax/delanswer/qid/{{info.id}}/id/{{a.answer_id}}" class="text-danger confirm ajax-get">删除</a>
                    </li>
                    <li class="pull-right">
                        <a href="/mod/question/ajax/editanswer/id/{{a.answer_id}}" class="text-primary lightbox" data-lightbox="iframe" data-plugin-options='{"type":"ajax", "closeOnBgClick":false}'>编辑</a>
                    </li>
                    {%endif%}
                </ul>

                <div class="mui-card-footer">
                    <a href="javascript:;"  class="text-info comment-reply" data-comment="comment-reply-{{a.answer_id}}"> 
                        <i class="fa fa-reply"></i> 
                        <span id="oc-{{a.answer_id}}">回复</span>
                        全部评论 (<span id="count-{{a.answer_id}}">{{a.ccount}}</span>)
                    </a>
                    <a href="/mod/question/ajax/delanswer/qid/{{info.id}}/id/{{a.answer_id}}" class="text-danger confirm ajax-get">删除</a>
                    <a href="/mod/question/ajax/editanswer/id/{{a.answer_id}}" class="text-primary lightbox" data-lightbox="iframe" data-plugin-options='{"type":"ajax", "closeOnBgClick":false}'>编辑</a>
                </div>
                #}
                {#
                <div class="mui-card-footer">
                    <a class="mui-card-link"><i class="mui-icon iconfont icon-focus"></i>{{val.focus_count}}</a>
                    <a class="mui-card-link"><i class="mui-icon iconfont icon-comment"></i>{{val.answer_count}}</a>
                    <a class="mui-card-link"><i class="mui-icon iconfont icon-attentionfavor"></i>{{val.view}}</a>
                </div>
                #}
            </div>
                {%endif%}
            {%endfor%}


				{%if i==1 %}
				<p class="text-center" style="color: #1eb6c1;">暂无评论</p>
				{%endif%}
            </ul>
            {#
            <ul class="mui-table-view " style="position: absolute;width: 100%;margin-bottom: 60px">
                <li class="mui-table-view-cell" style="text-align: center;">
                	
                    <!-- {%if controller.is_login%}
                    <a href="#answer"><span class="mui-icon iconfont icon-forward"></span> 回复 </a>
                    {%else%}
                    <a href="/uc/public/login"> 要回复问题请先 登录 或 注册 </a>
                    {%endif%} -->
                    

                    {% if category.id== 124 %}
                        {%if controller.is_login%}
                        <a href="#answer">
                            <button class="mui-btn-primary  margin-bottom-10 quetion-btn">
                                <span class="mui-icon mui-icon-compose"></span> 
                                回 答
                            </button>
                        </a>
                        {%else%}
                        <a href="/uc/public/login">
                            <button class="mui-btn-primary  margin-bottom-10 quetion-btn">
                                <span class="mui-icon iconfont icon-forward"></span> 
                                回 答
                            </button>
                        </a>
                        {%endif%}
                    {% else %}
                        {%if controller.is_login%}
                        <a href="#answer">
                            <button class="mui-btn-primary  margin-bottom-10 quetion-btn">
                                <span class="mui-icon mui-icon-compose"></span> 
                                回 答
                            </button>
                        </a>
                        {%else%}
                        <a href="/uc/public/login">
                            <button class="mui-btn-primary  margin-bottom-10 quetion-btn">
                                <span class="mui-icon iconfont icon-forward"></span> 
                                回 答
                            </button>
                        </a>
                        {%endif%}
                    {% endif %}

                   <!--  
                   
                   {%if controller.is_login%}
                   {%else%}
                   <a href="/uc/public/login"> 要回复问题请先 登录 或 注册 </a>
                   {%endif%} 
                   -->
					
                </li>
            </ul>
            #}

    </div>

                </div>
            </div>
    <ul class="mui-table-view " style="position: fixed;width: 100%;bottom:  15px;margin-top: 0px;">
        <li class="mui-table-view-cell" style="text-align: center;padding: 11px 0;">
            
            <!-- {%if controller.is_login%}
            <a href="#answer"><span class="mui-icon iconfont icon-forward"></span> 回复 </a>
            {%else%}
            <a href="/uc/public/login"> 要回复问题请先 登录 或 注册 </a>
            {%endif%} -->
            

            {% if category.id== 124 %}
                {%if controller.is_login%}
                <a href="#answer">
                    <button class="mui-btn-primary quetion-btn">
                        <span class="mui-icon mui-icon-compose"></span> 
                        回 答
                    </button>
                </a>
                {%else%}
                <a href="/uc/public/login">
                    <button class="mui-btn-primary quetion-btn">
                        <span class="mui-icon iconfont icon-forward"></span> 
                        回 答
                    </button>
                </a>
                {%endif%}
            {% else %}
                {%if controller.is_login%}
                <a href="#answer">
                    <button class="mui-btn-primary  quetion-btn">
                        <span class="mui-icon mui-icon-compose"></span> 
                        回 答
                    </button>
                </a>
                {%else%}
                <a href="/uc/public/login">
                    <button class="mui-btn-primary quetion-btn">
                        <span class="mui-icon iconfont icon-forward"></span> 
                        回 答
                    </button>
                </a>
                {%endif%}
            {% endif %}

           <!--  
           
           {%if controller.is_login%}
           {%else%}
           <a href="/uc/public/login"> 要回复问题请先 登录 或 注册 </a>
           {%endif%} 
           -->
            
        </li>
    </ul>
</div>
<!--回复评论-->
<div id="answer" class="mui-page" style="width: 100%;height: 100%;">
    <div class="mui-navbar-inner mui-bar mui-bar-nav" style="background-color: #1eb6c1;  ">
        <button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left" style="color: #fff;">
            <span class="mui-icon mui-icon-left-nav" ></span>
        </button>
        <!-- <h1 class="mui-center mui-title" style="color: #fff;text-align: center;"><span style="margin:0 auto;">回复</span> </h1> -->
        <button class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" id="answer_post" style="color: #fff;">确定</button>
    </div>
    <div class="mui-page-content">
        <form role="form" class="validate" action="/mod/question/sys/updateanswer" method="post" >
            {#
            <div class="mui-content-padded">
                <div class="mui-inline">回答:{{info.title}}</div>
            </div>
            #}
            <div class="mui-input-row" style="height:500px;"> <!-- height:800px; -->
                <textarea id='detail' name="answer_content" class="question" placeholder="请详细描述你的问题..." style="height: 100%;width: 100%">
                </textarea>
            </div>
            {#
            <ul class="mui-table-view">

                <li class="mui-table-view-cell">
                    <span>fdsfsd</span>
                    <div class="mui-switch mui-switch-blue">
                        <div class="mui-switch-handle"></div>
                    </div>
                </li>
            </ul>
            #}

            <!-- <input type="file" name="pic" id="pic" accept="image/*" class="upload-input" /> -->

            <br />
            <input type="hidden" name="u_id" value="{{info.uid}}">
            <input type="hidden" name="controller_id" value="{{controller.user.uid}}">

            <input type="hidden" checked="" name="anonymous" value="0">
            <input type="hidden" name="question_id" value="{{info.id}}">
            <input type="hidden" name="category_id" value="{{info.category_id}}">
            <input type="hidden" name="backurl" value="{{http.url}}">
        </form>

    </div>
</div>
<script type="text/template" id="tpl">
    {% raw %}
    <div class="mui-card" id="a<%=data.id%>">
        <div class="mui-card-header mui-card-media">
            <img src="/uc/index/avatar/uid/<%=data.data.uid%>">
            <div class="mui-media-body">
                <%=data.data.uid%>
                <p>发表于 <%=data.data.add_time%></p>
            </div>
        </div>
        <div class="mui-card-content">
            <div class="mui-card-content-inner padding-top-0 padding-bottom-0" >
                <div class="wangEditor-container cmswing-container">
                    <div class="wangEditor-txt nopadding">
                        <%=data.data.answer_content%>
                    </div>
                </div>
            </div>
        </div>
        <div class="mui-card-footer">
            <a class="mui-card-link"><i class="mui-icon iconfont icon-focus"></i>0</a>
            <a class="mui-card-link"><i class="mui-icon iconfont icon-comment"></i>0</a>
            <a class="mui-card-link"><i class="mui-icon iconfont icon-attentionfavor"></i>0</a>
        </div>
    </div>
    {% endraw %}
</script>
{% endblock%}

{% block script %}
<script src="/static/webapp/libs/deitor.wang/js/lib/zepto.js"></script>
<script src="/static/webapp/libs/deitor.wang/js/lib/zepto.touch.js"></script>
<script src="/static/webapp/libs/deitor.wang/js/wangEditor-mobile.js"></script>
<script src="/static/webapp/js/mui.view.js "></script>
<script type="text/javascript">

    //mui.init();
    //
    //开始上拉加载
    var tplRender =  _.template(document.getElementById("tpl").innerHTML);
    mui.init({
        pullRefresh: {
            container: '#pullrefresh',
            up: {
                contentrefresh: '上拉显示更多',
                contentnomore:'我是有底线的',
                callback: pullupRefresh
            }
        }
    });
    var tops=parseInt(sessionStorage.getItem("{{http.url}}_top"))||0;
    var size=parseInt(sessionStorage.getItem("{{http.url}}_size"))||0;
    //记录位置
    document.getElementById("pullrefresh").onscroll = function () {
        var patt1 = /\(.*?\)/;
        var srtY = document.querySelector('#pullrefresh .mui-scroll').style.transform || document.querySelector('#pullrefresh .mui-scroll').style["-webkit-transform"];
        if (srtY) {
            var Y = parseInt(srtY.match(patt1)[0].split(",")[1])
        } else {
            var Y = 0;
        }
        //console.log(Y)
        var S = document.querySelector('#pullrefresh .mui-table-view').querySelectorAll('.mui-card').length;
        //console.log(S);
        if (window.sessionStorage) {
            sessionStorage.setItem("{{http.url}}_top", Y);
            sessionStorage.setItem("{{http.url}}_size", S);
        }
    }
   
    /**
     * 下拉刷新具体业务实现
     */
    function pulldownRefresh() {
        setTimeout(function() {
            /*var table = document.body.querySelector('.mui-table-view');
            var cells = document.body.querySelectorAll('.mui-table-view-cell');
            for (var i = cells.length, len = i + 3; i < len; i++) {
                var li = document.createElement('li');
                li.className = 'mui-table-view-cell';
                li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
                //下拉刷新，新纪录插到最前面；
                table.insertBefore(li, table.firstChild);
            }*/
            mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
        }, 1500);
    }
    /**
     * 上拉加载具体业务实现
     */
    function pullupRefresh() {
        setTimeout(function() {

            var table = document.body.querySelector('#pullrefresh .mui-table-view');
            var cells = document.body.querySelectorAll('#pullrefresh .mui-card');
            var count = "{{info.answer_count}}";
            if(parseInt(cells.length) < parseInt(count)){
                createFragment(8);
                mui('#pullrefresh').pullRefresh().endPullupToRefresh();
            }else {
                mui('#pullrefresh').pullRefresh().endPullupToRefresh(true); //参数为true代表没有更多数据了。
            }

        }, 1000);
    }
    var createFragment = function(count, page) {
        //无限加载
        var table = document.body.querySelector('#pullrefresh .question_card');
        var lastIndex = table.querySelectorAll('.mui-card').length;
        var pages = page || Math.ceil((lastIndex+count)/count);
        var id = "{{info.id}}";
        var url = "/mod/question/index/answer/id/"+id+"/limit/"+count+"/page/"+pages;
        mui.ajax(url,{
            data:{
                page:pages
            },
            dataType:'json',//服务器返回json格式数据
            type:'get',//HTTP请求类型
            success:function(dataResult){
                //console.log(dataResult);
                //console.log(dataResult.data);
                //console.log(dataResult.data.data);
                var objectArray = dataResult.data.data;
//                //获得服务器响应
//                console.log();
//                var fragment = document.createDocumentFragment();
//                var li;
//                for (var i = 0; i < data.data.length; i++) {
//                    li = document.createElement('li');
//                    li.className = 'mui-table-view-cell';
//                    li.innerHTML ='<a href="javascript:;">'+
//                            '<img class="mui-media-object mui-pull-right" src="/static/webapp/img/yuantiao.jpg">'+
//                            '<div class="mui-media-body">'+
//                            data.data[i].title+
//                            '<p class="mui-ellipsis">静静的看这个世界，最后终于疯了</p>'+
//                            '</div>'+
//                            '</a>';
//                    fragment.appendChild(li);
//                }
//                table.appendChild(fragment);
                $.each(objectArray,function(k,v){
                    var html = "";
                    var div = document.createElement('div');
                    div.className = 'mui-card mui-cnm';
                    //console.log(v);
                    console.log(v.answer_id);
                    div.id = "abc"+v.answer_id ;
                    html = '<div class="mui-card-header mui-card-media">\
                                <img src="/uc/index/avatar/uid/'+v.uid+'" class="comment-avatar">\
                                <div class="mui-media-body">\
                                    '+v.username+'\
                                    <p class="comment-txt">'+v.add_time+'</p>\
                                </div>\
                            </div>\
                            <div class="mui-card-content">\
                                <div class="mui-card-content-inner padding-top-0 padding-bottom-0" >\
                                    <div class="wangEditor-container cmswing-container">\
                                        <div class="wangEditor-txt nopadding">\
                                            '+v.answer_content+'\
                                        </div>\
                                    </div>\
                                </div>\
                            </div>';
                    div.innerHTML = html;
                    //$('#pullrefresh .mui-table-view').append(div);
                    var muiCardArray = $('#pullrefresh .mui-table-view').find(".mui-card");
                    //console.log(muiCardArray);
                    var lastMuiCard = muiCardArray[muiCardArray.length-1];
                    //console.log(lastMuiCard);
                    lastMuiCard.after(div);
                });
                //$('#pullrefresh .mui-table-view').append(tplRender(data));
            }
        });
    };

    mui.ready(function() {

        //mui('#pullrefresh').pullRefresh().pullupLoading();
        var page = Math.ceil(size/8);
        if(page>1 ){
            for (var i = 1; i < (page+1); i++) {
                createFragment(8,(i+1))
            }
        }
        mui('#pullrefresh').pullRefresh().scrollTo(0,tops);
        //alert(1)
       /* document.querySelector('header h1').addEventListener('tap',function () {
            //内容区滚动到顶部
            mui('#pullrefresh').pullRefresh().scrollTo(0,0,100);
        });
       */
    });
    //点击展开全部
    mui.ready(function(){
        var array = $("article.cmswing-container").find(".wangEditor-txt").children()
        //console.log(array);
        for(var i=0;i<array.length;i++){
            //console.log(array[i])
            if(i>19){
                //console.log(i);
                var a = array[i];
                //console.log($(a));
                $(a).addClass("out");
            }
        }
        if(array.length<=19){
            $(".more").addClass("out")
        }
    })
    mui("article .more").on("tap","a",function(){
        var array = $(".wangEditor-txt").children();
        for(var i=0;i<array.length;i++){
            var a = array[i];
            //console.log($(a))
            if($(a).hasClass("out")){
                $(a).removeClass("out");
                $(".more").addClass("out")
            }  
        }
    })
    //点击回答按钮 编辑器menu display：blcok
    mui("article .more").on("tap","a",function(){
        var array = $(".wangEditor-txt").children();
        for(var i=0;i<array.length;i++){
            var a = array[i];
            //console.log($(a))
            if($(a).hasClass("out")){
                $(a).removeClass("out");
                $(".more").addClass("out")
            }  
        }
    })

    //初始化单页view
    var viewApi = mui('#app').view({
        defaultPage: '#index'
    });
    var view = viewApi.view;
    //处理view的后退与webview后退
    var oldBack = mui.back;
    mui.back = function() {
        if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
            viewApi.back();
        } else { //执行webview后退
            oldBack();
        }
    };
    $(function () {
        // ___E 三个下划线
        var editor = new ___E('detail');
        // 上传图片
        editor.config.uploadImgUrl = '/uc/file/uploadpic/type/path';
        editor.init();
    });
    //初始化单页的区域滚动
    mui('.mui-scroll-wrapper').scroll();

    //匿名
    mui('#answer .mui-switch').each(function() { //循环所有toggle
        //toggle.classList.contains('mui-active') 可识别该toggle的开关状态
        this.parentNode.querySelector('span').innerText = '匿名：' + (this.classList.contains('mui-active') ? '是' : '否');
        /**
         * toggle 事件监听
         */

        this.addEventListener('toggle', function(event) {
            //event.detail.isActive 可直接获取当前状态
            this.parentNode.querySelector('span').innerText = '匿名：' + (event.detail.isActive ? '是' : '否');
            if(event.detail.isActive){
                $("input[name='anonymous']").val(1)
            }else {
                $("input[name='anonymous']").val(0)
            }
        });
    });
    //回复
    var url = $(".validate").attr("action");
    // feedback.newPlaceholder();
    document.getElementById('answer_post').addEventListener('click', function(event) {
    	console.log($("#detail").text());
        if ($("#detail").text() == '') {
            return mui.toast('信息填写不符合规范');
        }
       
        var data = $(".validate").serialize();
        mui.ajax(url,{
            data:data,
            dataType:'json',//服务器返回json格式数据
            type:'post',//HTTP请求类型
            timeout:10000,//超时时间设置为10秒；
            //headers:{'Content-Type':'application/json'},
            success:function(data){
                //服务器返回响应，根据响应结果，分析是否登录成功；
                if(data.errno == 0){
                    // mui.toast(data.data.name);
                    // mui.back();
                    //console.log(data.data.data.id);
                    mui.alert("回复成功，点击确定关闭~","提示","确定",function () {
                        //location.href="/mod/question/{{info.id}}#a"+data.data.id;
                        //location.replace("/mod/question/{{info.id}}#a"+data.data.data.id)
                        //location.replace(location.href);
                        mui.back();
                        location.reload()
//                        mui.back();
//                        var tplRender =  _.template(document.getElementById("tpl").innerHTML);
//                        $('ul.question_card').append(tplRender(data.data));
//                        mui('.mui-scroll-wrapper').scroll().scrollToBottom(100);
                    });
                }else {
                    mui.toast(data.errmsg);
                }
            },
            error:function(xhr,type,errorThrown){
                //异常处理；
                console.log(type);
            }
        });

    })


    var btn = document.querySelectorAll(".mui-bar-tab a.mui-tab-item");
    for(var i = 0;i<btn.length;i++){
        btn[i].addEventListener("tap",function () {
            var href = this.getAttribute("href");
            if(href=="#top"){
                mui.scrollTo(0,500);
            }else if(href=="#shoucang"){
                //todo
                mui.toast("功能开发中。。。")
                return
            }else if(href=="#fenxiang"){
                //todo
                mui.toast("功能开发中。。。")
                return
            }else {
                mui.openWindow({url: href})
            }

        })
    }

</script>
{% endblock %}