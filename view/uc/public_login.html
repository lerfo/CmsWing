{% extends "./inc/base_login.html" %} {% block content %}
<!-- 
                PAGE HEADER 
                
                CLASSES:
                    .page-header-xs = 20px margins
                    .page-header-md = 50px margins
                    .page-header-lg = 80px margins
                    .page-header-xlg= 130px margins
                    .dark           = dark page header

                    .shadow-before-1    = shadow 1 header top
                    .shadow-after-1     = shadow 1 header bottom
                    .shadow-before-2    = shadow 2 header top
                    .shadow-after-2     = shadow 2 header bottom
                    .shadow-before-3    = shadow 3 header top
                    .shadow-after-3     = shadow 3 header bottom
                -->
                <!-- 
                <section class="page-header page-header-xs">
                    <div class="container">

                        
                        <ol class="breadcrumb breadcrumb-inverse">
                            <li><a href="/index">首页</a></li>
                            <li class="active">登录</li>
                        </ol>


                    </div>
                </section>-->
                <!-- /PAGE HEADER -->




                <!-- -->
                <section style="padding: 180px 0;">
                    <div class="container">

                        <div class="row">

                            <div class="row">
                                <div class="col-md-4 col-sm-4" style="margin-left: auto; margin-right: auto; float: none;background: rgba(248, 242, 252, 0.5)">
                        <!--<h3 class="m-t-none m-b">已有账号</h3>
                        <p>Sign in to meet your friends.</p>-->
                        <form role="form" class="nomargin sky-form boxed" id="login" method="post" autocomplete="off">
                            <header>
                                <!--<i class="fa fa-users"></i>--> {{controller.meta_title}}
                            </header>
                            <fieldset class="nomargin">
                                <label class="input margin-bottom-10">
                                    <i class="ico-append fa fa-mobile"></i>
                                    <input type="text" name="username" class="form-control" placeholder="邮箱/手机号/昵称" required="">
                                    <b class="tooltip tooltip-bottom-right">请输入中国大陆手机号</b>
                                </label>

                                <!--是否开启验证码-->
                            <!--
                            {%if controller.setup.GEETEST_IS_LOGIN ==1%}
                            <div class="form-group" style="margin-top: 16px !important;">
                                <div id="captcha"></div>
                                <p id="wait" class="show">正在加载验证码......</p>
                                <p id="notice" class="hide">请先拖动验证码到相应位置</p>
                            </div>
                            {%endif%}
                        -->
                        <label class="input margin-bottom-10">
                            <i class="ico-append fa fa-lock"></i>
                            <input type="password" name="password" class="form-control" placeholder="密码" required="">
                            <b class="tooltip tooltip-bottom-right">长度不少于6位字符,不允许有空格</b>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-6" style="padding-left: 0px;">
                            <label class="checkbox weight-300" style="font-size: 14px; color: #fff;">
                                <input type="checkbox" name="checkbox-inline">
                                <i></i> 记住我
                            </label>

                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-6" style="padding-right: 0px;">
                            <a href="#" class="pull-right" style="margin-top: 3px; color: #fff;">忘记密码?</a>
                        </div>

                        <div class="col-md-12 col-sm-12 col-xs-12 margin-top-10 margin-bottom-10" style="padding-left: 0px; padding-right: 0px;">

                            <button class="btn btn-primary" id="validate-submit" style="width: 100%; margin: 0;">登录</button>

                        </div>

                        <div class="col-md-12 col-sm-12 col-xs-12" style="padding-right: 0px;">
                            <a href="/uc/public/startregister" class="pull-right" style="margin-top: 3px; color: #fff;">立即注册</a>
                        </div>

                    </fieldset>

                </form>


                    <!--<form role="form" class="sky-form" id="login" method="post">
                        
                    <header>
                        <i class="fa fa-users"></i> {{controller.meta_title}}
                    </header>
                           <div class="form-group">
                            <label>账号</label>
                          
                            <input type="text" name="username" class="form-control" placeholder="邮箱/手机号/昵称" required="">
                            
                        </div>
                        <div class="form-group">
                            <label>密码</label>
                            
                            <input type="password" name="password" class="form-control" placeholder="密码" required="">
                            <div class="clearfix note">
                                <a href="#" class="pull-right">忘记密码?</a>
                            </div>
                        </div>
                        {%if controller.setup.GEETEST_IS_LOGIN ==1%}
                        <div class="form-group">
                            <div id="captcha"></div>
                            <p id="wait" class="show">正在加载验证码......</p>
                            <p id="notice" class="hide">请先拖动验证码到相应位置</p>
                        </div>
                        {%endif%}

                            <div id="alert"></div>
                        <div class="row">

                            <div class="col-md-6 col-sm-6 col-xs-6">
<label class="checkbox weight-300 margin-top-10">
                                        <input type="checkbox" name="checkbox-inline">
                                        <i></i> 记住我
                                    </label>

                            </div>

                            <div class="col-md-6 col-sm-6 col-xs-6 text-right">

                                <button class="btn btn-primary" id="validate-submit">登录</button>

                            </div>

                        </div>

                    </form>-->
                </div>
                <!--<div class="col-sm-5">
                    <h4>还没有账号?</h4>
                    <p>你可以在<a href="/uc/public/register" class="text-info">这里</a>创建一个帐户 </p>
                    <p>或者</p>
                    {%if controller.setup.IS_QQ_LOGIN == 1%}
                    <a href="/uc/qq/" class="btn btn-block btn-social btn-twitter margin-bottom-10">
                        <i class="fa fa-qq"></i> 使用QQ账号登录
                    </a>
                    {%endif%}
                    {%if controller.setup.IS_WEIXIN_LOGIN == 1%}
                    <a class="btn btn-block btn-social btn-facebook margin-bottom-10">
                                    <i class="fa fa-weixin"></i> 使用微信账号登录
                                </a>
                    {%endif%}
                    {%if controller.setup.IS_SINA_LOGIN == 1%}
                                <a href="/uc/sina/" class="btn btn-block btn-social btn-google margin-bottom-10">
                                    <i class="fa fa-weibo"></i> 使用新浪微博账号登录
                                </a>
                    {%endif%}
                </div>-->
            </div>
        </div>


    </div>
</section>
<!-- / -->
{% endblock %}


{% block script %}
{%if controller.setup.GEETEST_IS_LOGIN ==0%}
<!-- 引入封装了failback的接口--initGeetest -->

<!-- 引入封装了failback的接口--initGeetest -->
<script src="//static.geetest.com/static/tools/gt.js"></script>

<!-- 若是https，使用以下接口 -->
<!-- <script src="https://static.geetest.com/static/tools/gt.js"></script> -->
<script>
    $(function () {
        var handlerEmbed = function (captchaObj) {
            var success = false;
            $("#validate-submit").click(function () {
                var validate = captchaObj.getValidate();
                if (!validate) {
                    _toastr("请先完成验证!","top-right","error",false);
                    return false;
                }
                $.ajax({
                    url: "/uc/public/login", // 进行二次验证
                    type: "post",
                    dataType: "json",
                    data: {
                        // 二次验证所需的三个值
                        geetest_challenge: validate.geetest_challenge,
                        geetest_validate: validate.geetest_validate,
                        geetest_seccode: validate.geetest_seccode,
                        username:$("input[name='username']").val(),
                        password:$("input[name='password']").val()
                    },
                    success: function (data) {

                        if (data && (data.errno < 0)) {

                            _toastr(data.errmsg,"top-right","error",false);
                            captchaObj.refresh();

                        } else {
                            location.reload();
                        }
                    }
                });
                return false;
            });

            // 将验证码加到id为captcha的元素里
            captchaObj.appendTo("#captcha");

            captchaObj.onReady(function () {
                $("#wait")[0].className = "hide";
            });

            // 更多接口参考：http://www.geetest.com/install/sections/idx-client-sdk.html
        };
        $("#captcha").ready(function(){
            setTimeout(function(){
                $.ajax({
                    // 获取id，challenge，success（是否启用failback）
                    url: "/admin/public/geetest?t=" + (new Date()).getTime(), // 加随机数防止缓存
                    type: "get",
                    dataType: "json",
                    success: function (data) {

                        // 使用initGeetest接口
                        // 参数1：配置参数
                        // 参数2：回调，回调的第一个参数验证码对象，之后可以使用它做appendTo之类的事件
                        initGeetest({
                            gt: data.gt,
                            challenge: data.challenge,
                            product: "float", // 产品形式，包括：float，embed，popup。注意只对PC版验证码有效
                            offline: !data.success // 表示用户后台检测极验服务器是否宕机，一般不需要关注
                        }, handlerEmbed);
                    }
                });

            },1000);
        });
    })

</script>
{%else%}
<script>
    _login();
</script>
{%endif%}
{% endblock %}
